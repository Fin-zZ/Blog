(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{385:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"前端vue项目eslint检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端vue项目eslint检查"}},[t._v("#")]),t._v(" 前端Vue项目ESLint检查")]),t._v(" "),a("p",[t._v("借助gitlab-runner执行代码检查，可实现云端统一的代码检查，减少代码中的坏味道，统一代码规范。")]),t._v(" "),a("h3",{attrs:{id:"_1-开发进行代码提交"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-开发进行代码提交"}},[t._v("#")]),t._v(" 1. 开发进行代码提交")]),t._v(" "),a("h3",{attrs:{id:"_2-云端触发ci-yml文件执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-云端触发ci-yml文件执行"}},[t._v("#")]),t._v(" 2. 云端触发ci.yml文件执行")]),t._v(" "),a("h3",{attrs:{id:"_3-gitlab-runner首先也需要install-node包，会借助cache缓存下来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-gitlab-runner首先也需要install-node包，会借助cache缓存下来"}},[t._v("#")]),t._v(" 3. gitlab-runner首先也需要install node包，会借助"),a("code",[t._v("cache")]),t._v("缓存下来")]),t._v(" "),a("h3",{attrs:{id:"_4-会执行脚本内地npm-run-eslint指令-同时需要在我们本地的package-json文件中的script命令里需添加-eslint-eslint-ext-vue-ignore-path-gitignore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-会执行脚本内地npm-run-eslint指令-同时需要在我们本地的package-json文件中的script命令里需添加-eslint-eslint-ext-vue-ignore-path-gitignore"}},[t._v("#")]),t._v(" 4. 会执行脚本内地"),a("code",[t._v("npm run eslint")]),t._v("指令,同时需要在我们本地的package.json文件中的"),a("code",[t._v("script")]),t._v("命令里需添加 "),a("code",[t._v('"eslint": "eslint --ext .vue --ignore-path .gitignore ."')])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("(gitlab-runner的执行环境shell，`直接执行eslint --ext .vue --ignore-path .gitignore .`也是可以的，但实际上会报错，找不到eslint命令，这里稍后处理)\n")])])]),a("h3",{attrs:{id:"_5-根据eslint的结果判断成功与否，进入下一执行阶段。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-根据eslint的结果判断成功与否，进入下一执行阶段。"}},[t._v("#")]),t._v(" 5. 根据eslint的结果判断成功与否，进入下一执行阶段。")]),t._v(" "),a("h3",{attrs:{id:"_6-失败，执行git-revert，回退一个版本，并记录下来是因为eslint出错导致提交失败（也可用git-reset，但没有记录），这里目前git-push失败还未找到解决方案。同时向微信群助手发送消息。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-失败，执行git-revert，回退一个版本，并记录下来是因为eslint出错导致提交失败（也可用git-reset，但没有记录），这里目前git-push失败还未找到解决方案。同时向微信群助手发送消息。"}},[t._v("#")]),t._v(" 6. 失败，执行git revert，回退一个版本，并记录下来是因为eslint出错导致提交失败（也可用git reset，但没有记录），这里目前git push失败还未找到解决方案。同时向微信群助手发送消息。")]),t._v(" "),a("h3",{attrs:{id:"_7-成功则只是简单发送一条消息（发布频繁的话，可以取消）。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-成功则只是简单发送一条消息（发布频繁的话，可以取消）。"}},[t._v("#")]),t._v(" 7. 成功则只是简单发送一条消息（发布频繁的话，可以取消）。")]),t._v(" "),a("p",[t._v(".gitlab-ci.yml文件如下")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" install\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" eslint\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" notify\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_COMMIT_REF_SLUG'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm i\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sonar\n    \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eslint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eslint\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" develop\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run eslint\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sonar\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notify-fail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" notify\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n      curl 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=XXXXXXXXXXXXXXXXXXXXXXXXXXX'\n      -H 'Content-Type: application/json'\n      -d \"可以发送相关的失败通知\"")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git revert "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("n HEAD~0\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git commit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("m 'eslint_check_failed'\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cat .git/config\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git push\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" develop\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" on_failure\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sonar\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notify-success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" notify\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n      curl 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=XXXXXXXXXXXXXXXXXXXXX'\n      -H 'Content-Type: application/json'\n      -d \"相关的成功通知\"")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" sonar\n")])])]),a("p",[t._v("流程很清晰，待商榷的点在于，Eslint检查报错后，有没有必要真的进行"),a("code",[t._v("git revert")]),t._v(" or "),a("code",[t._v("git reset")]),t._v("？\n回退版本应该是件慎重的事，再者遇上突发bug，hotfix分支合并入master时，如果也被回退，\n是否有些过于苛刻。\n最终商量结果：不进行版本回退，只进行企业微信群通知（或者类似通知开发群）。")])])}),[],!1,null,null,null);s.default=e.exports}}]);